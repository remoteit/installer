#!/bin/sh

#  connectd_startup_control
#
#  Run 'sudo connectd_startup_control' to control startup of 
#  installed remote.it attachment services for tcp listeners.
#  This controls services registered using bulk and auto registration.
#
#  remote.it, Inc. Copyright 2018. All rights reserved.
#
##### Settings #####
VERSION=2.1.6
AUTHOR="Gary Worsham"
MODIFIED="February 07, 2019"
DEBUG="0"

#==========================================================================

. /usr/bin/connectd_library

########## Begin menuLoopA #################
menuLoopA()
{
    while [ true ]; do
   #     clear
        printf "======================= Main Menu =======================\n"
        printf "                                                         \n"
        printf "    1) Set connectd_start to run at boot (systemd)       \n"
        printf "    2) Set connectd_start to run at boot (Sys-V)         \n"
        printf "    3) Disable connectd_start at boot (both)             \n"
        printf "    4) Exit                                              \n"
        printf "                                                         \n"
        printf "=========================================================\n"

        getNumRange 1 4 "Choose a menu selection"
        get_num="$getNumRangeValue"
        debug "get_num: $get_num"

        if [ "$get_num" = 1 ]; then
		enable_systemd
#		disable_sysv
		echo "connectd_start configured to boot (systemd)"
        elif [ "$get_num" = 2 ]; then
		enable_sysv
#		disable_systemd
		echo "connectd_start configured to boot (Sys-V)"
        elif [ "$get_num" = 3 ]; then
		disable_systemd
		disable_sysv
		echo "connectd_start disabled at boot (systemd and Sys-V)"
        elif [ "$get_num" = 4 ]; then
            exit
        fi
    done
}

######## ##### End menuLoopA #######################

enable_systemd()
{
    systemctl enable connectd
    systemctl enable connectd_schannel
}

disable_systemd()
{
    systemctl disable connectd
    systemctl disable connectd_schannel
}

enable_sysv()
{
    update-rc.d -f connectd enable defaults 99 10
    update-rc.d -f connectd_schannel enable defaults 99 10
}

disable_sysv()
{
    update-rc.d -f connectd disable
    update-rc.d -f connectd_schannel disable
}

######### Main Program #########
main()
{
    displayVersion
    checkForRoot
# =============================================    
    menuLoopA
# =============================================   
}

######### End Main Program #########
# 
main 
